{{- define "aether-kernel.extraContainers" }}
{{ if .Values.provider.gcp }}
- name: cloudsql-proxy
  image: gcr.io/cloudsql-docker/gce-proxy:1.11
  command: ["/cloud_sql_proxy",
            "-instances={{ .Values.database.instance }}=tcp:5432",
            "-credential_file=/secrets/cloudsql/credentials.json"]
  volumeMounts:
    - name: cloudsql-instance-credentials
      mountPath: /secrets/cloudsql
      readOnly: true
{{ end }}
- name: nginx
  image: nginx:stable-alpine
  ports:
  - containerPort: 80
  volumeMounts:
  - mountPath: /var/www/static
    name: static-assets-volume
  - mountPath: /etc/nginx/conf.d
    name: nginx-config
{{- end }}