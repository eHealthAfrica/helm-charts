{{- define "aether-kernel.env" }}
- name: DEBUG
  value: {{ if .Values.debug }}"1"{{ else }}""{{ end }}
- name: GATEWAY_SERVICE_ID
  value: {{ .Values.app.gateWay.serviceId }}
- name: GATEWAY_PUBLIC_REALM
  value: "{{ .Values.app.gateWay.gatewayPublicRealm }}"
- name: DEFAULT_REALM
  value: "{{ .Values.app.gateWay.defaultRealm }}"
- name: KEYCLOAK_SERVER_URL
  value: {{ .Values.app.keycloak.externalUrl }}
- name: KEYCLOAK_CLIENT_ID
  value: {{ .Values.app.keycloak.clientId }}
- name: CSRF_COOKIE_DOMAIN
  value: {{ .Values.domain }}
- name: CSRF_TRUSTED_ORIGINS
  value: .{{ .Values.domain }}
- name: DJANGO_STORAGE_BACKEND
  value: {{ .Values.app.storage.backend }}
- name: BUCKET_NAME
  value: {{ .Values.app.storage.bucket.name }}
- name: APP_NAME
  value: {{ .Values.app.name }}
{{ if .Values.provider.aws }}
- name: AWS_S3_REGION_NAME
  value: {{ .Values.app.storage.bucket.region }}
- name: AWS_DEFAULT_ACL
  value: {{ .Values.app.storage.bucket.default_acl }}
{{ end }}
{{ if .Values.app.caching.enabled }}
- name: DJANGO_USE_CACHE
  value: "true"
- name: REDIS_DB_CACHEOPS
  value: "1"
{{ end }}
{{- if or .Values.app.caching.enabled .Values.app.exm.enabled }}
- name: REDIS_DB
  value: "0"
- name: REDIS_HOST
  value: {{ .Values.app.redis.host }}
- name: REDIS_PORT
  value: {{ .Values.app.redis.port |  default "6379" | quote }}
{{- end }}
{{ if .Values.app.exm.enabled }}
- name: WRITE_ENTITIES_TO_REDIS
  value: "false"
{{ end }}
{{ if .Values.app.caching.enabled }}
- name: DJANGO_USE_CACHE
  value: "true"
- name: REDIS_DB_CACHEOPS
  value: "1"
- name: REDIS_DJANGO_CACHE
  value: "true"
- name: REDIS_DB_DJANGO
  value: "2"
- name: REDIS_SESSION_CACHE
  value: "true"
- name: REDIS_DB_SESSION
  value: "3"
{{ end }}
{{ if .Values.sentry.enabled }}
- name: SENTRY_DSN
  valueFrom:
    secretKeyRef:
      name: {{ .Values.app.secret }}
      key: sentry-dsn
{{ end }}
- name: DJANGO_SECRET_KEY
  valueFrom:
    secretKeyRef:
      name: {{ .Values.app.secret }}
      key: kernel-django-secret-key
- name: ADMIN_USERNAME
  value: {{ .Values.app.admin_user }}
- name: ADMIN_PASSWORD
  valueFrom:
    secretKeyRef:
      name: {{ .Values.app.secret }}
      key: kernel-django-admin-password
- name: ADMIN_TOKEN
  valueFrom:
    secretKeyRef:
      name: {{ .Values.app.secret }}
      key: kernel-django-admin-token
- name: PGPASSWORD
  valueFrom:
    secretKeyRef:
      name: {{ .Values.app.secret }}
      key: kernel-database-password
- name: PGUSER
  value: {{ .Values.app.db.user }}
- name: PGPORT
  value: {{ .Values.app.db.port | default 5432 | quote }}
- name: PGHOST
  value: {{ .Values.app.db.host }}
- name: DB_NAME
  value: {{ .Values.app.db.name }}
- name: TESTING
  value: {{ quote .Values.testing }}
{{ if .Values.provider.gcp }}
- name: GOOGLE_APPLICATION_CREDENTIALS
  value: {{ .Values.app.storage.bucket.credentialsPath }}
{{ end }}
# `WEB_SERVER_PORT` is kept around for compatibility with the old tests,
# which are using different ports in different environments. Once all
# tests have been updated to run inside the cluster, `WEB_SERVER_PORT`
# can be removed.
- name: WEB_SERVER_PORT
  value: {{ quote .Values.app.port }}
- name: UWSGI_THREADS
  value: {{ .Values.app.uwsgi.threads | quote }}
{{- end }}