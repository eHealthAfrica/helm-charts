{{- define "aether-odk.initContainers" }}
- name: init
  image: postgres:9.6-alpine
  command: ['bash', '-c', './scripts/init.sh']
  env:
  - name: PGHOST
    valueFrom :
      secretKeyRef:
        name: {{ .Values.app.db.secret }}
        key: host
  - name: PGUSER
    valueFrom:
      secretKeyRef:
        name: {{ .Values.app.db.secret }}
        key: user
  - name: PGPASSWORD
    valueFrom:
      secretKeyRef:
        name: {{ .Values.app.db.secret }}
        key: password
  - name: DB_USERNAME
    value: {{ .Values.app.db.user }}
  - name: DB_PASSWORD
    valueFrom:
      secretKeyRef:
        name: {{ .Values.app.secret }}
        key: odk-database-password
  - name: DB_NAME
    value: {{ .Values.app.db.name }}
  volumeMounts:
  - mountPath: /scripts
    name: odk-init
  {{ if .Values.provider.gcp }}
  - name: cloudsql-instance-credentials
    mountPath: /secrets/cloudsql
    readOnly: true
  {{ end }}
{{-  end }}
